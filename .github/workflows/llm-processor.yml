# .github/workflows/gemini-bulk-processor.yml
name: Gemini Bulk File Processor

on:
  workflow_dispatch:
    inputs:
      input_file:
        description: '–ü—É—Ç—å –∫ –≤—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏'
        required: true
        type: string
        default: 'data/facts27.txt'
      
      prompt:
        description: '–ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏'
        required: true
        type: string
        default: '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –∏ –≤—ã–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç—ã'
      
      output_filename:
        description: '–ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)'
        required: true
        type: string
        default: 'processed_facts'
      
      model:
        description: '–ú–æ–¥–µ–ª—å Gemini API'
        required: false
        type: choice
        options:
          - 'gemini-2.0-flash'
          - 'gemini-2.0-flash-lite'
          - 'gemini-2.5-flash'
          - 'gemini-2.5-flash-lite'
          - 'gemini-2.5-pro'
          - 'gemini-1.5-flash'
          - 'gemini-1.5-pro'
        default: 'gemini-2.0-flash'
      
      chunk_size:
        description: '–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –≤ —Ç–æ–∫–µ–Ω–∞—Ö (–¥–ª—è –ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è)'
        required: false
        type: choice
        options:
          - '500000'
          - '1000000'
          - '1500000'
          - '2000000'
          - '3000000'
        default: '1000000'
      
      delay_between_chunks:
        description: '–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö'
        required: false
        type: choice
        options:
          - '0'
          - '5'
          - '10'
          - '15'
          - '30'
          - '60'
        default: '0'
      
      concurrent_requests:
        description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤'
        required: false
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '5'
          - '10'
        default: '3'

jobs:
  validate-inputs:
    name: Validate Inputs
    runs-on: ubuntu-latest
    outputs:
      file-exists: ${{ steps.check.outputs.exists }}
      estimated-time: ${{ steps.estimate.outputs.time }}
      file-size: ${{ steps.check.outputs.file_size }}
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Check if input file exists
      id: check
      run: |
        if [ -f "${{ github.event.inputs.input_file }}" ]; then
          echo "exists=true" >> $GITHUB_OUTPUT
          echo "‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: ${{ github.event.inputs.input_file }}"
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
          file_size=$(wc -c < "${{ github.event.inputs.input_file }}")
          echo "file_size=$file_size" >> $GITHUB_OUTPUT
          echo "üìÅ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(($file_size / 1024))KB ($(($file_size / 1024 / 1024))MB)"
          
          # –ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ (1 —Ç–æ–∫–µ–Ω ‚âà 4 —Å–∏–º–≤–æ–ª–∞)
          estimated_tokens=$(($file_size / 4))
          chunk_size=${{ github.event.inputs.chunk_size }}
          estimated_chunks=$(($estimated_tokens / $chunk_size + 1))
          
          echo "üî¢ –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤: $(printf "%'d" $estimated_tokens)"
          echo "üì¶ –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤: $estimated_chunks"
          
        else
          echo "exists=false" >> $GITHUB_OUTPUT
          echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: ${{ github.event.inputs.input_file }}"
          exit 1
        fi
    
    - name: Estimate processing time for paid tier
      id: estimate
      if: steps.check.outputs.exists == 'true'
      run: |
        file_size=$(wc -c < "${{ github.event.inputs.input_file }}")
        estimated_tokens=$(($file_size / 4))
        chunk_size=${{ github.event.inputs.chunk_size }}
        estimated_chunks=$(($estimated_tokens / $chunk_size + 1))
        delay=${{ github.event.inputs.delay_between_chunks }}
        concurrent=${{ github.event.inputs.concurrent_requests }}
        
        # –í—Ä–µ–º—è –¥–ª—è –ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è (–±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
        processing_time_per_chunk=10  # 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ —á–∞–Ω–∫ –¥–ª—è –ø–ª–∞—Ç–Ω–æ–≥–æ API
        total_processing_time=$((($estimated_chunks * $processing_time_per_chunk) / $concurrent))
        total_delay_time=$(($estimated_chunks * $delay))
        estimated_minutes=$(($total_processing_time + $total_delay_time) / 60)
        
        echo "time=${estimated_minutes}" >> $GITHUB_OUTPUT
        echo "‚è±Ô∏è –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${estimated_minutes} –º–∏–Ω—É—Ç"
        echo "üöÄ –ü–ª–∞—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å $concurrent –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏"
        
        if [ $estimated_minutes -gt 30 ]; then
          echo "‚ÑπÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–π–º–µ—Ç –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç"
        fi

  process-file:
    name: Process File with Gemini (Paid Tier)
    runs-on: ubuntu-latest
    needs: validate-inputs
    if: needs.validate-inputs.outputs.file-exists == 'true'
    
    permissions:
      contents: write
      actions: read
    
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      PYTHONUNBUFFERED: 1
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Validate API key
      run: |
        if [ -z "$GEMINI_API_KEY" ]; then
          echo "‚ùå GEMINI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Secrets"
          echo "–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Secrets and variables ‚Üí Actions"
          echo "–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π secret —Å –∏–º–µ–Ω–µ–º GEMINI_API_KEY"
          exit 1
        else
          echo "‚úÖ API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω"
        fi
    
    - name: Create output directory
      run: |
        mkdir -p outputs
        echo "üìÅ –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è outputs/"
    
    - name: Show processing parameters (Paid Tier)
      run: |
        echo "üöÄ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ü–õ–ê–¢–ù–´–ô –£–†–û–í–ï–ù–¨):"
        echo "   üìÑ –§–∞–π–ª: ${{ github.event.inputs.input_file }}"
        echo "   üìè –†–∞–∑–º–µ—Ä: $((${{ needs.validate-inputs.outputs.file-size }} / 1024))KB"
        echo "   ü§ñ –ú–æ–¥–µ–ª—å: ${{ github.event.inputs.model }}"
        echo "   üì¶ –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞: $(printf "%'d" ${{ github.event.inputs.chunk_size }}) —Ç–æ–∫–µ–Ω–æ–≤"
        echo "   ‚ö° –ó–∞–¥–µ—Ä–∂–∫–∞: ${{ github.event.inputs.delay_between_chunks }} —Å–µ–∫—É–Ω–¥ (–±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)"
        echo "   üîÑ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: ${{ github.event.inputs.concurrent_requests }}"
        echo "   üíæ –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª: ${{ github.event.inputs.output_filename }}.txt"
        echo "   üìù –ü—Ä–æ–º–ø—Ç: ${{ github.event.inputs.prompt }}"
        echo ""
        echo "üí≥ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏–º–∏—Ç—ã –ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏"
    
    - name: Process file with Gemini API (Paid Tier)
      id: process
      run: |
        echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–∞ –Ω–∞ –ø–ª–∞—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ..."
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        set +e
        
        python main.py \
          --file "${{ github.event.inputs.input_file }}" \
          --prompt "${{ github.event.inputs.prompt }}" \
          --output "outputs/${{ github.event.inputs.output_filename }}.txt" \
          --model "${{ github.event.inputs.model }}" \
          --chunk-size "${{ github.event.inputs.chunk_size }}" \
          --delay "${{ github.event.inputs.delay_between_chunks }}" \
          --concurrent "${{ github.event.inputs.concurrent_requests }}" \
          --paid-tier
        
        exit_code=$?
        
        if [ $exit_code -eq 0 ]; then
          echo "‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
          echo "success=true" >> $GITHUB_OUTPUT
        elif [ $exit_code -eq 2 ]; then
          echo "‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ"
          echo "success=partial" >> $GITHUB_OUTPUT
        else
          echo "‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏ (–∫–æ–¥: $exit_code)"
          echo "success=false" >> $GITHUB_OUTPUT
        fi
    
    - name: Check output file
      id: check_output
      run: |
        output_file="outputs/${{ github.event.inputs.output_filename }}.txt"
        
        if [ -f "$output_file" ]; then
          file_size=$(wc -c < "$output_file")
          line_count=$(wc -l < "$output_file")
          word_count=$(wc -w < "$output_file")
          
          echo "üìÑ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: $output_file"
          echo "üìè –†–∞–∑–º–µ—Ä: $(($file_size / 1024))KB ($(($file_size / 1024 / 1024))MB)"
          echo "üìù –°—Ç—Ä–æ–∫: $(printf "%'d" $line_count)"
          echo "üìù –°–ª–æ–≤: $(printf "%'d" $word_count)"
          
          echo "file_created=true" >> $GITHUB_OUTPUT
          echo "file_size=$file_size" >> $GITHUB_OUTPUT
          echo "line_count=$line_count" >> $GITHUB_OUTPUT
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          echo ""
          echo "üîç –ü–µ—Ä–≤—ã–µ 15 —Å—Ç—Ä–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:"
          echo "================================"
          head -15 "$output_file"
          echo ""
          echo "üîç –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:"
          echo "=================================="
          tail -10 "$output_file"
          
        else
          echo "‚ùå –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–Ω"
          echo "file_created=false" >> $GITHUB_OUTPUT
        fi
    
    - name: Upload result as artifact
      if: steps.check_output.outputs.file_created == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: ${{ github.event.inputs.output_filename }}-${{ github.event.inputs.model }}-paid-result
        path: outputs/${{ github.event.inputs.output_filename }}.txt
        retention-days: 90
        compression-level: 0
    
    - name: Create processing summary
      if: always()
      run: |
        summary_file="outputs/processing_summary.md"
        
        cat > "$summary_file" << EOF
        # üöÄ –û—Ç—á–µ—Ç –æ–± –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞ (–ü–ª–∞—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)
        
        ## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
        - **–í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª**: \`${{ github.event.inputs.input_file }}\`
        - **–†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**: $((${{ needs.validate-inputs.outputs.file-size }} / 1024))KB
        - **–ú–æ–¥–µ–ª—å**: \`${{ github.event.inputs.model }}\`
        - **–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞**: $(printf "%'d" ${{ github.event.inputs.chunk_size }}) —Ç–æ–∫–µ–Ω–æ–≤
        - **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏**: ${{ github.event.inputs.delay_between_chunks }} —Å–µ–∫—É–Ω–¥
        - **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**: ${{ github.event.inputs.concurrent_requests }}
        - **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: $(date)
        - **–£—Ä–æ–≤–µ–Ω—å**: üí≥ –ü–ª–∞—Ç–Ω—ã–π (–≤—ã—Å–æ–∫–∏–µ –ª–∏–º–∏—Ç—ã)
        
        ## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç
        - **–°—Ç–∞—Ç—É—Å**: ${{ steps.process.outputs.success || 'failed' }}
        - **–§–∞–π–ª —Å–æ–∑–¥–∞–Ω**: ${{ steps.check_output.outputs.file_created || 'false' }}
        EOF
        
        if [ "${{ steps.check_output.outputs.file_created }}" == "true" ]; then
          echo "- **–†–∞–∑–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**: $((${{ steps.check_output.outputs.file_size }} / 1024))KB" >> "$summary_file"
          echo "- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫**: $(printf "%'d" ${{ steps.check_output.outputs.line_count }})" >> "$summary_file"
        fi
        
        echo "" >> "$summary_file"
        echo "## üí≠ –ü—Ä–æ–º–ø—Ç" >> "$summary_file"
        echo "\`\`\`" >> "$summary_file"
        echo "${{ github.event.inputs.prompt }}" >> "$summary_file"
        echo "\`\`\`" >> "$summary_file"
        
        echo "" >> "$summary_file"
        echo "## ‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è" >> "$summary_file"
        echo "- –í—ã—Å–æ–∫–∏–µ –ª–∏–º–∏—Ç—ã TPM (—Ç–æ–∫–µ–Ω–æ–≤ –≤ –º–∏–Ω—É—Ç—É)" >> "$summary_file"
        echo "- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏" >> "$summary_file"
        echo "- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞–Ω–∫–æ–≤" >> "$summary_file"
        echo "- –ë–æ–ª—å—à–∏–µ —Ä–∞–∑–º–µ—Ä—ã —á–∞–Ω–∫–æ–≤ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏" >> "$summary_file"
        
        cat "$summary_file"
    
    - name: Upload summary
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: processing-summary-paid
        path: outputs/processing_summary.md
        retention-days: 30
    
    - name: Create performance metrics
      if: steps.check_output.outputs.file_created == 'true'
      run: |
        metrics_file="outputs/performance_metrics.json"
        
        cat > "$metrics_file" << EOF
        {
          "processing_date": "$(date -Iseconds)",
          "input_file": "${{ github.event.inputs.input_file }}",
          "input_size_bytes": ${{ needs.validate-inputs.outputs.file-size }},
          "output_size_bytes": ${{ steps.check_output.outputs.file_size }},
          "model": "${{ github.event.inputs.model }}",
          "chunk_size": ${{ github.event.inputs.chunk_size }},
          "delay_seconds": ${{ github.event.inputs.delay_between_chunks }},
          "concurrent_requests": ${{ github.event.inputs.concurrent_requests }},
          "tier": "paid",
          "status": "${{ steps.process.outputs.success }}",
          "estimated_processing_time_minutes": ${{ needs.validate-inputs.outputs.estimated-time }}
        }
        EOF
        
        echo "üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"
        cat "$metrics_file"
    
    - name: Upload metrics
      if: steps.check_output.outputs.file_created == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: performance-metrics
        path: outputs/performance_metrics.json
        retention-days: 90
    
    - name: Commit results to repository
      if: steps.check_output.outputs.file_created == 'true'
      continue-on-error: true
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Gemini Processor Bot"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        git add outputs/
        
        if git diff --staged --quiet; then
          echo "‚ÑπÔ∏è –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        else
          timestamp=$(date '+%Y-%m-%d %H:%M:%S')
          model="${{ github.event.inputs.model }}"
          chunk_size="${{ github.event.inputs.chunk_size }}"
          
          git commit -m "üöÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ –ø–ª–∞—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ: ${{ github.event.inputs.output_filename }}.txt

          üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
          - –ú–æ–¥–µ–ª—å: $model
          - –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞: $(printf "%'d" $chunk_size) —Ç–æ–∫–µ–Ω–æ–≤
          - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å: ${{ github.event.inputs.concurrent_requests }}x
          - –í—Ä–µ–º—è: $timestamp"
          
          # –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git push; then
            echo "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
          else
            echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞)"
          fi
        fi

  notify-completion:
    name: Notify Completion
    runs-on: ubuntu-latest
    needs: [validate-inputs, process-file]
    if: always()
    
    steps:
    - name: Processing completion summary
      run: |
        echo "üéØ –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê (–ü–õ–ê–¢–ù–´–ô –£–†–û–í–ï–ù–¨)"
        echo "========================================"
        echo "üìÑ –§–∞–π–ª: ${{ github.event.inputs.input_file }}"
        echo "üìè –†–∞–∑–º–µ—Ä: $((${{ needs.validate-inputs.outputs.file-size }} / 1024))KB"
        echo "ü§ñ –ú–æ–¥–µ–ª—å: ${{ github.event.inputs.model }}"
        echo "üì¶ –ß–∞–Ω–∫: $(printf "%'d" ${{ github.event.inputs.chunk_size }}) —Ç–æ–∫–µ–Ω–æ–≤"
        echo "‚ö° –ó–∞–¥–µ—Ä–∂–∫–∞: ${{ github.event.inputs.delay_between_chunks }}—Å"
        echo "üîÑ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å: ${{ github.event.inputs.concurrent_requests }}x"
        echo "‚è±Ô∏è –í—Ä–µ–º—è: $(date)"
        echo ""
        
        if [ "${{ needs.process-file.result }}" == "success" ]; then
          echo "‚úÖ –°—Ç–∞—Ç—É—Å: –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
          echo ""
          echo "üì• –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
          echo "   1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É 'Actions'"
          echo "   2. –í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–æ—Ç workflow"
          echo "   3. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:"
          echo "      - '${{ github.event.inputs.output_filename }}-${{ github.event.inputs.model }}-paid-result' (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)"
          echo "      - 'processing-summary-paid' (–æ—Ç—á–µ—Ç)"
          echo "      - 'performance-metrics' (–º–µ—Ç—Ä–∏–∫–∏)"
        elif [ "${{ needs.process-file.result }}" == "failure" ]; then
          echo "‚ùå –°—Ç–∞—Ç—É—Å: –û—à–∏–±–∫–∞"
          echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π"
        else
          echo "‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ"
          echo "   –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —á–∞–Ω–∫–∏ –º–æ–≥–ª–∏ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã"
        fi
        
        echo ""
        echo "üí≥ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã:"
        echo "   ‚úÖ –í—ã—Å–æ–∫–∏–µ –ª–∏–º–∏—Ç—ã TPM"
        echo "   ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏"
        echo "   ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"
        echo "   ‚úÖ –ë–æ–ª—å—à–∏–µ —á–∞–Ω–∫–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
